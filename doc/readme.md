# Partial technical documents
## 1. 游戏设计创意： 
这一章节主要讲述的是本人自己设计的游戏——锅打灰太狼的创作创意来源以及实现想法应用到嵌入式板子 Jz2440 的游戏的设计必须要以硬件为基础，jz2440 的学习过的输入可以是串口，也可以是按键的输入，但是基于板子的独立游戏不需要用到与其他的嵌入式板子或者电脑进行交互的过程，因此可以使用的输入便是 4 个不同的按键，游戏的设计应该具有明显的人机交互性，jz2440 的输出可以是 LCD 显示屏或者是三个 LED 灯，游戏的设计应该充分利用已有的硬件资源设计。

## 2. 实现方法
- 启动引导程序内存空间配置
  - head.s 一开始是中断向量表的表头以及一些初始化的操作，这里需要关注的是 head.s 中调用了 CopyCode2SDRAM 将代码 copy 到 SDRAM 中，clean_bss 函数主要是将 bss 段清 0，方便后面未初始化或者初值为 0 的全局变量等存放
  - 烧入代码后，head.o，init.o，nand.o 等放在 SRAM 中，而经过 CopyCode2SDRAM 这个函数后 framebuffer.c 等代码段、图片等数据段以及变量，静态变量 bss 段依次放在 SDRAM 开始位置后。代码段在内存中的分布还可以通过.dis 反汇编文件确认查看

- 主函数设计
  - Main 函数按照简易的原则，主要是一个死循环以及按键、LED 灯和中断的初始化，按键、LED灯的初始化以及中断的开启不在此处赘述，这里有必要提及的是中断的初始化，该程序使用判断中断类型时运用到了中断向量表(在文件 s3c24xx.h 中定义了中断的编号)

- 图像显示
由于个人信息，游戏规则以及游戏主页面三张图片都是在 ppt 上经过修正后转化为图片，在转换的时候没有严格对齐屏幕尺寸 480 * 272，只做了 480 * 270，因此这里对显示函数的尺寸做了修改，16 位真彩色的图片主要由高八位以及低八位组成，要注意的是使用 image2lcd 的时候我选择了高位在前（MSB First），因此在合并数据的时候需要对生成的图片数组的高位进行一个移位操作

- 游戏设计
game.c 中主要写的是游戏的内容
  - void game()中写的即是游戏的流程，首先进入游戏，定时器开始初始化，设置 0.5s 定时一次，各种变量初始化后开启定时器开始计时，后面是一个 while 循环，主要是判断满不满足胜利或者失败的条件。
  - 由于 jz2440 的 LCD 屏幕的刷新率已经定下来无法改变，从之前的实验可知刷新一整个屏幕需要较长的时间，因此只能在部分区域进行刷新才可能尽量接近动图的效果，而每个洞口在屏幕的位置不同，因此需要使用不同的函数去进行显示，这里我使用 hole1 函数显示洞 1 的图像，使用 hole2 函数显示洞 2 的图像，使用 hole3 函数显示洞 3 的图像，显示的函数相似

- 中断服务函数设计
Interrupt.c 中主要是写三个按键中断以及定时器中断的服务函数，该游戏的进行与中断密切相关，不同画面的转换以及游戏中的退出确认机制，击打还有时间条的显示都与之相关 S2 按键对应 EINT0

  - 按键在不同的显示页面中发挥着不同的功能，在还没进入游戏时（windowstate！=2）S1 按键以及 S2 按键主要的作用是在个人信息显示页面以及规则显示页面中切换，S4、S5 按键都具有进入游戏页面的功能。当进入游戏 2.5s 后，S5 按键按下即会显示退出确认页面，此时 S5 的中断清除，但还没有退出中断服务函数，而是在 exit_wait 函数中，此时如果按下 S1 按键，则 exit=0，退出游戏，若按下 S2，则 exit=2，继续游戏；当退出键没有按下时，若按下 S2、S3、S4 按键中的任意一个，则会判断按键的对应的洞口是否有狼，有的话进行击打

- 图像数据生成
图像数据的生成通过1.设计 2.动图区域定位 3.坐标点转化 4.转码 四个步骤生成

## 3. 更多
如果需要更多的帮助或者觉得有什么不足的地方，可以联系我，我会尽力帮助你！